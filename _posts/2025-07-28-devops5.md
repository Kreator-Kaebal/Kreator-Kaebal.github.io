---
layout: post
title: 최종 프로젝트 인프라 구축③-minikube 환경 설정
categories: [devops]
tags: [virtualbox, linux, kubernetes]
excerpt: minikube로 간편한 로컬 클라스터 구축
---

# minikube로 간편한 로컬 클라스터 구축

## 개요

네트워크 문제까지 해결되었으니, 클라스터 서버에 쿠버 클라스터를 구성해보겠다.

**minikube**를 사용하면 kubeadm 같이 CP-워커노드 복잡한 구성 없이 바로 클라스터를 구성할 수 있다.

빠르게 진행해야 하기 때문에, minikube로 구현해 보겠다.

## 호스트 전용 어댑터 IP로 원격접속

[지난 시간](https://kreator-kaebal.github.io/posts/devops4/)에 구성한 virtualbox의 호스트 전용 어댑터는 **192.168.56.xxx** 대역에서만 호스트에서 원격으로 접속할 수 있다. 왜 56 인지는 저도 몰라요...

![do5-img3](/images/posts/devops5-img3.png)

그래서 클라스터 IP를 192.168.56.100, 젠킨스 IP를 192.168.56.101 로 변경하였다.

참고로 원격 접속하기 위해서는 서버에

```bash
firewall-cmd --zone=public --add-port=22/tcp --permanent
firewall-cmd --reload
```

![do5-img1](/images/posts/devops5-img1.png)

로 방화벽에 22포트를 허용해 주고

![do5-img2](/images/posts/devops5-img2.png)

```/etc/ssh/sshd_config``` 에서 위 형광펜 친 것처럼 해 주고  
```systemctl restart sshd``` 해 줘야 한다.
(사실 sshd_config 설정은 해 줄 필요 없지만 혹시 모르니)

![do5-img4](/images/posts/devops5-img4.png)

이러면 위 사진처럼 ssh 원격 접속이 된다!

## minikube 설치

![do5-img5](/images/posts/devops5-img5.png)

미니큐브 설치는 위 사진처럼

```bash
curl -LO https://github.com/kubernetes/minikube/releases/latest/download/minikube-linux-amd64
sudo install minikube-linux-amd64 /usr/local/bin/minikube && rm minikube-linux-amd64
```

이 명령어를 실행해주면 된다.  
그런 다음 ```minikube start```해주면 되는데...

![do5-img6](/images/posts/devops5-img6.png)

이렇게 오류가 뜰 수 있다. 요지는 쿠버에 쓸 컨테이너 드라이버를 찾지 못했다는 것인데...

그럼 docker를 깔면 되지 않나라고 생각할 수 있겠지만

**Rocky Linux 8을 포함한 RHEL 계열에서는 docker보다 podman을 권장한다.** 라고 한다. 8버전 부턴가 독커 지원을 끊었다고 한다.

즉 당직 환경은 록키 리눅스8이니까 podman을 쓰는 게 건강에도 이롭다.  
참고로 록키 리눅스8에서는 최소 설치가 아니면 podman이 기본 설치되어 있긴 하지만...

아무튼 이야기가 샜고 podman은 깔려 있지만 실행이 안되고 있는데,

저 로그를 자세히 읽어보면 **현재 계정으로 sudo붙여 podman 명령어를 하려고 하지만 비밀번호가 필요해서 실패**라고 한다.  

그래서 ```sudo visudo``` 명령어로 sudoers 파일에 현재 계정(admin)의 특정 권한을 부여해야 한다.
(그리고 맨 위에 보면 알겠지만 podman은 루트로 실행하면 안된다고 한다)

![do5-img7](/images/posts/devops5-img7.png)

```visudo```를 하면 이렇게 ```vi /etc/sudoers```를 한 것과 같은 편집창이 뜨는데  
(```sudo vi /etc/sudoers```로 들어가면 수정이 불가능하다. 반드시 비수도로)

위 사진처럼 **맨 아래 줄에**

```bash
(minikube를 실행할 계정) ALL=(ALL) NOPASSWD: /usr/bin/podman
```

이렇게 **podman 명령어에 대해서만 sudo 비밀번호 인증 예외** 규칙을 걸어주면 된다.

이러고 다시 ```minikube start``` 명령어를 실행해 주면...

![do5-img8](/images/posts/devops5-img8.png)

클라스터가 구성되기 시작된다!